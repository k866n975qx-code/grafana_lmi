{
  "__inputs": [],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.0.0" }
  ],
  "annotations": { "list": [] },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "panels": [
    {
      "id": 1,
      "type": "table",
      "title": "Rolling Period Summary",
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 10 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [{ "refId": "A", "format": "table", "queryType": "table",
        "queryText": "SELECT REPLACE(REPLACE(REPLACE(REPLACE(s.period_type, 'WEEK_ROLLING', 'WTD'), 'MONTH_ROLLING', 'MTD'), 'QUARTER_ROLLING', 'QTD'), 'YEAR_ROLLING', 'YTD') AS period, s.period_start_date || ' -> ' || s.period_end_date AS range, CAST(json_extract(s.payload_json, '$.period_summary.totals.end.total_market_value') AS REAL) AS end_mv, CAST(json_extract(s.payload_json, '$.period_summary.totals.delta.total_market_value') AS REAL) AS mv_delta, CAST(json_extract(s.payload_json, '$.period_summary.income.end.projected_monthly_income') AS REAL) AS end_income, CAST(json_extract(s.payload_json, '$.period_summary.income.delta.projected_monthly_income') AS REAL) AS income_delta, CAST(json_extract(s.payload_json, '$.period_summary.performance.period.twr_period_pct') AS REAL) AS twr_pct, CAST(json_extract(s.payload_json, '$.period_summary.performance.period.pnl_dollar_period') AS REAL) AS pnl, CAST(json_extract(s.payload_json, '$.period_summary.goal_progress.delta.progress_pct') AS REAL) AS goal_delta_pct, CAST(json_extract(s.payload_json, '$.period_summary.composition.end.holding_count') AS INTEGER) AS holdings FROM snapshots s WHERE s.period_type IN ('WEEK_ROLLING', 'MONTH_ROLLING', 'QUARTER_ROLLING', 'YEAR_ROLLING') AND s.period_end_date = (SELECT MAX(s2.period_end_date) FROM snapshots s2 WHERE s2.period_type = s.period_type) ORDER BY CASE s.period_type WHEN 'WEEK_ROLLING' THEN 1 WHEN 'MONTH_ROLLING' THEN 2 WHEN 'QUARTER_ROLLING' THEN 3 WHEN 'YEAR_ROLLING' THEN 4 END;",
        "rawQueryText": "SELECT REPLACE(REPLACE(REPLACE(REPLACE(s.period_type, 'WEEK_ROLLING', 'WTD'), 'MONTH_ROLLING', 'MTD'), 'QUARTER_ROLLING', 'QTD'), 'YEAR_ROLLING', 'YTD') AS period, s.period_start_date || ' -> ' || s.period_end_date AS range, CAST(json_extract(s.payload_json, '$.period_summary.totals.end.total_market_value') AS REAL) AS end_mv, CAST(json_extract(s.payload_json, '$.period_summary.totals.delta.total_market_value') AS REAL) AS mv_delta, CAST(json_extract(s.payload_json, '$.period_summary.income.end.projected_monthly_income') AS REAL) AS end_income, CAST(json_extract(s.payload_json, '$.period_summary.income.delta.projected_monthly_income') AS REAL) AS income_delta, CAST(json_extract(s.payload_json, '$.period_summary.performance.period.twr_period_pct') AS REAL) AS twr_pct, CAST(json_extract(s.payload_json, '$.period_summary.performance.period.pnl_dollar_period') AS REAL) AS pnl, CAST(json_extract(s.payload_json, '$.period_summary.goal_progress.delta.progress_pct') AS REAL) AS goal_delta_pct, CAST(json_extract(s.payload_json, '$.period_summary.composition.end.holding_count') AS INTEGER) AS holdings FROM snapshots s WHERE s.period_type IN ('WEEK_ROLLING', 'MONTH_ROLLING', 'QUARTER_ROLLING', 'YEAR_ROLLING') AND s.period_end_date = (SELECT MAX(s2.period_end_date) FROM snapshots s2 WHERE s2.period_type = s.period_type) ORDER BY CASE s.period_type WHEN 'WEEK_ROLLING' THEN 1 WHEN 'MONTH_ROLLING' THEN 2 WHEN 'QUARTER_ROLLING' THEN 3 WHEN 'YEAR_ROLLING' THEN 4 END;"
      }],
      "options": { "showHeader": true, "cellHeight": "md" },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          { "matcher": { "id": "byName", "options": "period" }, "properties": [{ "id": "displayName", "value": "Period" }] },
          { "matcher": { "id": "byName", "options": "range" }, "properties": [{ "id": "displayName", "value": "Range" }] },
          { "matcher": { "id": "byName", "options": "end_mv" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "End MV" }] },
          { "matcher": { "id": "byName", "options": "mv_delta" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "MV Delta" }] },
          { "matcher": { "id": "byName", "options": "end_income" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "End Income" }] },
          { "matcher": { "id": "byName", "options": "income_delta" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "Income Delta" }] },
          { "matcher": { "id": "byName", "options": "twr_pct" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "decimals", "value": 2 }, { "id": "displayName", "value": "TWR %" }] },
          { "matcher": { "id": "byName", "options": "pnl" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "P&L $" }] },
          { "matcher": { "id": "byName", "options": "goal_delta_pct" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "decimals", "value": 2 }, { "id": "displayName", "value": "Goal Progress Delta" }] },
          { "matcher": { "id": "byName", "options": "holdings" }, "properties": [{ "id": "displayName", "value": "Holdings" }] }
        ]
      }
    },
    {
      "id": 2,
      "type": "table",
      "title": "Rolling Risk Comparison",
      "gridPos": { "x": 0, "y": 10, "w": 24, "h": 8 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [{ "refId": "A", "format": "table", "queryType": "table",
        "queryText": "SELECT REPLACE(REPLACE(REPLACE(REPLACE(s.period_type, 'WEEK_ROLLING', 'WTD'), 'MONTH_ROLLING', 'MTD'), 'QUARTER_ROLLING', 'QTD'), 'YEAR_ROLLING', 'YTD') AS period, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.vol_30d_pct') AS REAL) AS vol_30d, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.vol_30d_pct') AS REAL) AS vol_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.sortino_1y') AS REAL) AS sortino, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.sortino_1y') AS REAL) AS sortino_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.sharpe_1y') AS REAL) AS sharpe, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.sharpe_1y') AS REAL) AS sharpe_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.max_drawdown_1y_pct') AS REAL) AS max_dd, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.max_drawdown_1y_pct') AS REAL) AS max_dd_delta, json_extract(s.payload_json, '$.period_summary.risk.end.portfolio_risk_quality') AS risk_quality FROM snapshots s WHERE s.period_type IN ('WEEK_ROLLING', 'MONTH_ROLLING', 'QUARTER_ROLLING', 'YEAR_ROLLING') AND s.period_end_date = (SELECT MAX(s2.period_end_date) FROM snapshots s2 WHERE s2.period_type = s.period_type) ORDER BY CASE s.period_type WHEN 'WEEK_ROLLING' THEN 1 WHEN 'MONTH_ROLLING' THEN 2 WHEN 'QUARTER_ROLLING' THEN 3 WHEN 'YEAR_ROLLING' THEN 4 END;",
        "rawQueryText": "SELECT REPLACE(REPLACE(REPLACE(REPLACE(s.period_type, 'WEEK_ROLLING', 'WTD'), 'MONTH_ROLLING', 'MTD'), 'QUARTER_ROLLING', 'QTD'), 'YEAR_ROLLING', 'YTD') AS period, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.vol_30d_pct') AS REAL) AS vol_30d, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.vol_30d_pct') AS REAL) AS vol_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.sortino_1y') AS REAL) AS sortino, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.sortino_1y') AS REAL) AS sortino_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.sharpe_1y') AS REAL) AS sharpe, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.sharpe_1y') AS REAL) AS sharpe_delta, CAST(json_extract(s.payload_json, '$.period_summary.risk.end.max_drawdown_1y_pct') AS REAL) AS max_dd, CAST(json_extract(s.payload_json, '$.period_summary.risk.delta.max_drawdown_1y_pct') AS REAL) AS max_dd_delta, json_extract(s.payload_json, '$.period_summary.risk.end.portfolio_risk_quality') AS risk_quality FROM snapshots s WHERE s.period_type IN ('WEEK_ROLLING', 'MONTH_ROLLING', 'QUARTER_ROLLING', 'YEAR_ROLLING') AND s.period_end_date = (SELECT MAX(s2.period_end_date) FROM snapshots s2 WHERE s2.period_type = s.period_type) ORDER BY CASE s.period_type WHEN 'WEEK_ROLLING' THEN 1 WHEN 'MONTH_ROLLING' THEN 2 WHEN 'QUARTER_ROLLING' THEN 3 WHEN 'YEAR_ROLLING' THEN 4 END;"
      }],
      "options": { "showHeader": true, "cellHeight": "md" },
      "fieldConfig": {
        "defaults": { "decimals": 2 },
        "overrides": [
          { "matcher": { "id": "byName", "options": "period" }, "properties": [{ "id": "displayName", "value": "Period" }] },
          { "matcher": { "id": "byName", "options": "vol_30d" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "displayName", "value": "Vol 30d %" }] },
          { "matcher": { "id": "byName", "options": "vol_delta" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "displayName", "value": "Vol Delta" }] },
          { "matcher": { "id": "byName", "options": "sortino" }, "properties": [{ "id": "displayName", "value": "Sortino 1y" }] },
          { "matcher": { "id": "byName", "options": "sortino_delta" }, "properties": [{ "id": "displayName", "value": "Sortino Delta" }] },
          { "matcher": { "id": "byName", "options": "sharpe" }, "properties": [{ "id": "displayName", "value": "Sharpe 1y" }] },
          { "matcher": { "id": "byName", "options": "sharpe_delta" }, "properties": [{ "id": "displayName", "value": "Sharpe Delta" }] },
          { "matcher": { "id": "byName", "options": "max_dd" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "displayName", "value": "Max DD %" }] },
          { "matcher": { "id": "byName", "options": "max_dd_delta" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "displayName", "value": "DD Delta" }] },
          { "matcher": { "id": "byName", "options": "risk_quality" }, "properties": [{ "id": "displayName", "value": "Risk Quality" }] }
        ]
      }
    }
  ],
  "refresh": "2m",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["lmi", "periods"],
  "time": { "from": "now-90d", "to": "now" },
  "timezone": "browser",
  "title": "LMI - Rolling Detail",
  "uid": "lmi-rolling-detail",
  "version": 1
}
