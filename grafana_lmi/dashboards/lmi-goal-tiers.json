{
  "__inputs": [],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.0.0" }
  ],
  "annotations": { "list": [] },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "panels": [
    {
      "id": 1,
      "type": "stat",
      "title": "Likely Tier",
      "gridPos": { "x": 0, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT json_extract(payload_json, '$.goal_pace.likely_tier.tier') || ' - ' || json_extract(payload_json, '$.goal_pace.likely_tier.name') AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT json_extract(payload_json, '$.goal_pace.likely_tier.tier') || ' - ' || json_extract(payload_json, '$.goal_pace.likely_tier.name') AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "value", "values": false },
        "textMode": "value",
        "wideLayout": true
      },
      "fieldConfig": {
        "defaults": { "color": { "mode": "fixed", "fixedColor": "blue" } },
        "overrides": []
      }
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Pace Category",
      "gridPos": { "x": 4, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT UPPER(json_extract(payload_json, '$.goal_pace.current_pace.pace_category')) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT UPPER(json_extract(payload_json, '$.goal_pace.current_pace.pace_category')) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "value", "values": false },
        "textMode": "value",
        "wideLayout": true
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            { "type": "value", "options": { "AHEAD": { "text": "AHEAD", "color": "green" }, "ON_TRACK": { "text": "ON TRACK", "color": "green" }, "BEHIND": { "text": "BEHIND", "color": "yellow" }, "OFF_TRACK": { "text": "OFF TRACK", "color": "red" } } }
          ]
        },
        "overrides": []
      }
    },
    {
      "id": 3,
      "type": "stat",
      "title": "Months Ahead / Behind",
      "gridPos": { "x": 8, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT CAST(json_extract(payload_json, '$.goal_pace.current_pace.months_ahead_behind') AS REAL) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT CAST(json_extract(payload_json, '$.goal_pace.current_pace.months_ahead_behind') AS REAL) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "options": {
        "colorMode": "value", "graphMode": "none", "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "value", "values": false },
        "textMode": "value_and_name", "wideLayout": true
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none", "decimals": 1,
          "thresholds": { "mode": "absolute", "steps": [{ "value": null, "color": "red" }, { "value": -3, "color": "yellow" }, { "value": 0, "color": "green" }] }
        },
        "overrides": []
      }
    },
    {
      "id": 4,
      "type": "stat",
      "title": "Revised Goal Date",
      "gridPos": { "x": 12, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT json_extract(payload_json, '$.goal_pace.current_pace.revised_goal_date') AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT json_extract(payload_json, '$.goal_pace.current_pace.revised_goal_date') AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "options": { "colorMode": "none", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "value", "values": false }, "textMode": "value", "wideLayout": true },
      "fieldConfig": { "defaults": {}, "overrides": [] }
    },
    {
      "id": 5,
      "type": "stat",
      "title": "Revised Months to Goal",
      "gridPos": { "x": 16, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT CAST(json_extract(payload_json, '$.goal_pace.current_pace.revised_months_to_goal') AS INTEGER) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT CAST(json_extract(payload_json, '$.goal_pace.current_pace.revised_months_to_goal') AS INTEGER) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "none", "decimals": 0 }, "overrides": [] }
    },
    {
      "id": 6,
      "type": "stat",
      "title": "Confidence",
      "gridPos": { "x": 20, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "SELECT UPPER(json_extract(payload_json, '$.goal_pace.likely_tier.confidence')) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;",
          "rawQueryText": "SELECT UPPER(json_extract(payload_json, '$.goal_pace.likely_tier.confidence')) AS value FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1;"
        }
      ],
      "options": {
        "colorMode": "background", "graphMode": "none", "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "value", "values": false },
        "textMode": "value", "wideLayout": true
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            { "type": "value", "options": { "HIGH": { "text": "HIGH", "color": "green" }, "MEDIUM": { "text": "MEDIUM", "color": "yellow" }, "LOW": { "text": "LOW", "color": "red" } } }
          ]
        },
        "overrides": []
      }
    },
    {
      "id": 7,
      "type": "table",
      "title": "Goal Tier Roadmap",
      "description": "All 6 tiers with projections. The likely tier (auto-detected from your behavior) is highlighted.",
      "gridPos": { "x": 0, "y": 5, "w": 24, "h": 12 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        {
          "refId": "A", "format": "table", "queryType": "table",
          "queryText": "WITH latest AS (SELECT payload_json FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1) SELECT CAST(json_extract(t.value, '$.tier') AS INTEGER) AS tier, json_extract(t.value, '$.name') AS name, CAST(json_extract(t.value, '$.months_to_goal') AS INTEGER) AS months_to_goal, json_extract(t.value, '$.estimated_goal_date') AS goal_date, CAST(json_extract(t.value, '$.required_portfolio_value') AS REAL) AS required_pv, CAST(json_extract(t.value, '$.additional_investment_needed') AS REAL) AS additional_needed, CASE WHEN json_extract(t.value, '$.assumptions.drip_enabled') THEN 'Yes' ELSE 'No' END AS drip, CAST(json_extract(t.value, '$.assumptions.monthly_contribution') AS REAL) AS monthly_contrib, CAST(json_extract(t.value, '$.assumptions.annual_appreciation_pct') AS REAL) AS appreciation_pct, CASE WHEN json_extract(t.value, '$.assumptions.ltv_maintained') THEN 'Yes' ELSE 'No' END AS leverage, CASE WHEN CAST(json_extract(t.value, '$.tier') AS INTEGER) = CAST(json_extract(latest.payload_json, '$.goal_pace.likely_tier.tier') AS INTEGER) THEN 'CURRENT' ELSE '' END AS active FROM latest, json_each(latest.payload_json, '$.goal_tiers.tiers') AS t ORDER BY CAST(json_extract(t.value, '$.tier') AS INTEGER);",
          "rawQueryText": "WITH latest AS (SELECT payload_json FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1) SELECT CAST(json_extract(t.value, '$.tier') AS INTEGER) AS tier, json_extract(t.value, '$.name') AS name, CAST(json_extract(t.value, '$.months_to_goal') AS INTEGER) AS months_to_goal, json_extract(t.value, '$.estimated_goal_date') AS goal_date, CAST(json_extract(t.value, '$.required_portfolio_value') AS REAL) AS required_pv, CAST(json_extract(t.value, '$.additional_investment_needed') AS REAL) AS additional_needed, CASE WHEN json_extract(t.value, '$.assumptions.drip_enabled') THEN 'Yes' ELSE 'No' END AS drip, CAST(json_extract(t.value, '$.assumptions.monthly_contribution') AS REAL) AS monthly_contrib, CAST(json_extract(t.value, '$.assumptions.annual_appreciation_pct') AS REAL) AS appreciation_pct, CASE WHEN json_extract(t.value, '$.assumptions.ltv_maintained') THEN 'Yes' ELSE 'No' END AS leverage, CASE WHEN CAST(json_extract(t.value, '$.tier') AS INTEGER) = CAST(json_extract(latest.payload_json, '$.goal_pace.likely_tier.tier') AS INTEGER) THEN 'CURRENT' ELSE '' END AS active FROM latest, json_each(latest.payload_json, '$.goal_tiers.tiers') AS t ORDER BY CAST(json_extract(t.value, '$.tier') AS INTEGER);"
        }
      ],
      "options": { "showHeader": true, "cellHeight": "md" },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          { "matcher": { "id": "byName", "options": "required_pv" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "Required PV" }] },
          { "matcher": { "id": "byName", "options": "additional_needed" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "Additional Needed" }] },
          { "matcher": { "id": "byName", "options": "monthly_contrib" }, "properties": [{ "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 0 }, { "id": "displayName", "value": "Monthly Contrib" }] },
          { "matcher": { "id": "byName", "options": "appreciation_pct" }, "properties": [{ "id": "unit", "value": "percent" }, { "id": "decimals", "value": 1 }, { "id": "displayName", "value": "Apprec %" }] },
          { "matcher": { "id": "byName", "options": "months_to_goal" }, "properties": [{ "id": "displayName", "value": "Months" }] },
          { "matcher": { "id": "byName", "options": "goal_date" }, "properties": [{ "id": "displayName", "value": "Goal Date" }] },
          { "matcher": { "id": "byName", "options": "tier" }, "properties": [{ "id": "displayName", "value": "Tier" }] },
          { "matcher": { "id": "byName", "options": "name" }, "properties": [{ "id": "displayName", "value": "Name" }] },
          { "matcher": { "id": "byName", "options": "drip" }, "properties": [{ "id": "displayName", "value": "DRIP" }] },
          { "matcher": { "id": "byName", "options": "leverage" }, "properties": [{ "id": "displayName", "value": "Leverage" }] },
          {
            "matcher": { "id": "byName", "options": "active" },
            "properties": [
              { "id": "displayName", "value": "Active" },
              { "id": "mappings", "value": [{ "type": "value", "options": { "CURRENT": { "text": "CURRENT", "color": "green" } } }] },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          }
        ]
      }
    }
  ],
  "refresh": "2m",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["lmi", "goals"],
  "time": { "from": "now-180d", "to": "now" },
  "timezone": "browser",
  "title": "LMI - Goal Tiers",
  "uid": "lmi-goal-tiers",
  "version": 1
}
