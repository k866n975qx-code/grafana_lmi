{
  "__inputs": [],
  "__requires": [{ "type": "grafana", "id": "grafana", "name": "Grafana", "version": "10.0.0" }],
  "annotations": { "list": [] },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "panels": [
    {
      "id": 1,
      "type": "table",
      "title": "Top Weights Concentration (Top1/Top3/Top5)",
      "gridPos": { "x": 0, "y": 0, "w": 12, "h": 6 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        { "refId": "A", "format": "table", "queryType": "table",
          "queryText": "WITH s AS (SELECT payload_json j FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1), w AS (SELECT CAST(json_extract(h.value,'$.weight_pct') AS REAL) AS wt FROM s, json_each(s.j,'$.holdings') h ORDER BY wt DESC) SELECT ROUND((SELECT wt FROM w LIMIT 1),2) AS top1_pct, ROUND((SELECT SUM(wt) FROM (SELECT wt FROM w LIMIT 3)),2) AS top3_pct, ROUND((SELECT SUM(wt) FROM (SELECT wt FROM w LIMIT 5)),2) AS top5_pct;",
          "rawQueryText": "WITH s AS (SELECT payload_json j FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1), w AS (SELECT CAST(json_extract(h.value,'$.weight_pct') AS REAL) AS wt FROM s, json_each(s.j,'$.holdings') h ORDER BY wt DESC) SELECT ROUND((SELECT wt FROM w LIMIT 1),2) AS top1_pct, ROUND((SELECT SUM(wt) FROM (SELECT wt FROM w LIMIT 3)),2) AS top3_pct, ROUND((SELECT SUM(wt) FROM (SELECT wt FROM w LIMIT 5)),2) AS top5_pct;"
        }
      ],
      "options": { "showHeader": true, "cellHeight": "sm" },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          { "matcher": { "id": "byName", "options": "top1_pct" }, "properties": [ { "id": "unit", "value": "percent" }, { "id": "decimals", "value": 2 } ] },
          { "matcher": { "id": "byName", "options": "top3_pct" }, "properties": [ { "id": "unit", "value": "percent" }, { "id": "decimals", "value": 2 } ] },
          { "matcher": { "id": "byName", "options": "top5_pct" }, "properties": [ { "id": "unit", "value": "percent" }, { "id": "decimals", "value": 2 } ] }
        ]
      }
    },
    {
      "id": 2,
      "type": "table",
      "title": "Income Concentration (Top1/Top3/Top5)",
      "gridPos": { "x": 12, "y": 0, "w": 12, "h": 6 },
      "datasource": { "type": "frser-sqlite-datasource", "uid": "lmi_sqlite" },
      "targets": [
        { "refId": "A", "format": "table", "queryType": "table",
          "queryText": "WITH s AS (SELECT payload_json j FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1), inc AS (SELECT CAST(json_extract(h.value,'$.projected_monthly_dividend') AS REAL) AS mdiv FROM s, json_each(s.j,'$.holdings') h ORDER BY mdiv DESC) SELECT ROUND((SELECT mdiv FROM inc LIMIT 1),2) AS top1_mo, ROUND((SELECT SUM(mdiv) FROM (SELECT mdiv FROM inc LIMIT 3)),2) AS top3_mo, ROUND((SELECT SUM(mdiv) FROM (SELECT mdiv FROM inc LIMIT 5)),2) AS top5_mo;",
          "rawQueryText": "WITH s AS (SELECT payload_json j FROM snapshot_daily_current ORDER BY as_of_date_local DESC LIMIT 1), inc AS (SELECT CAST(json_extract(h.value,'$.projected_monthly_dividend') AS REAL) AS mdiv FROM s, json_each(s.j,'$.holdings') h ORDER BY mdiv DESC) SELECT ROUND((SELECT mdiv FROM inc LIMIT 1),2) AS top1_mo, ROUND((SELECT SUM(mdiv) FROM (SELECT mdiv FROM inc LIMIT 3)),2) AS top3_mo, ROUND((SELECT SUM(mdiv) FROM (SELECT mdiv FROM inc LIMIT 5)),2) AS top5_mo;"
        }
      ],
      "options": { "showHeader": true, "cellHeight": "sm" },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          { "matcher": { "id": "byName", "options": "top1_mo" }, "properties": [ { "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 2 } ] },
          { "matcher": { "id": "byName", "options": "top3_mo" }, "properties": [ { "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 2 } ] },
          { "matcher": { "id": "byName", "options": "top5_mo" }, "properties": [ { "id": "unit", "value": "currencyUSD" }, { "id": "decimals", "value": 2 } ] }
        ]
      }
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "style": "dark",
  "tags": ["lmi"],
  "time": { "from": "now-90d", "to": "now" },
  "timezone": "browser",
  "title": "LMI - Concentration",
  "uid": "lmi-concentration",
  "version": 1
}
